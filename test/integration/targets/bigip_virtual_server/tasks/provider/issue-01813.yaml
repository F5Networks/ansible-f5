---

- name: Issue 01813 - Testing idempotency of bigip_virtual_server
  bigip_virtual_server:
    name: ANSIBLE_CREATED_THIS_VIRTUAL_SERVER
    state: present
    description: "Born out of a playbook"
    partition: TEST
    provider: "{{ provider }}"
    destination: "0.0.0.0/0"
    port: "443"
    type: "performance-l4"
    profiles: ['/Common/fastL4']
#        profiles:
#          - {name: fastL4, partition: Common}
    source: "0.0.0.0/0"
    snat: none
    address_translation: True
    port_translation: True
    register: result

- name: Issue 01813 - Testing idempotency of bigip_virtual_server
  assert:
    that:
      - result is changed
      - result is success

- name: Issue 01813 - Testing idempotency of bigip_virtual_server - Idempotent check
  bigip_virtual_server:
    name: ANSIBLE_CREATED_THIS_VIRTUAL_SERVER
    state: present
    description: "Born out of a playbook"
    partition: TEST
    provider: "{{ provider }}"
    destination: "0.0.0.0/0"
    port: "443"
    type: "performance-l4"
    profiles: ['/Common/fastL4']
#        profiles:
#          - {name: fastL4, partition: Common}
    source: "0.0.0.0/0"
    snat: none
    address_translation: True
    port_translation: True
    register: result

- name: Issue 01813 - Testing idempotency of bigip_virtual_server - Idempotent check
  assert:
    that:
      - result is not changed
      - result is success


- name: Issue 01813 - Remove bigip_virtual_server - Idempotent check
  bigip_virtual_server:
    name: ANSIBLE_CREATED_THIS_VIRTUAL_SERVER
    state: absent
    description: "Born out of a playbook"
    partition: TEST
    provider: "{{ provider }}"
    destination: "0.0.0.0/0"
    port: "443"
    type: "performance-l4"
    profiles: ['/Common/fastL4']
    source: "0.0.0.0/0"
    snat: none
    address_translation: True
    port_translation: True
    register: result
